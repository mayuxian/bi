(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-53eb240c"],{1561:function(e,t,i){},"2cd6":function(e,t,i){"use strict";i("7496")},"334b":function(e,t,i){"use strict";i("97d6")},4155:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-container",{staticClass:"union-box"},[i("el-header",{staticStyle:{padding:"0px",height:"auto","margin-bottom":"2px"}},[i("h2",{staticStyle:{display:"inline-block"}},[e._v("数据创建连接")]),i("el-button",{staticStyle:{display:"inline-block","margin-left":"20px"},attrs:{size:"small",type:"primary"},on:{click:e.onClose}},[e._v("关闭")])],1),i("el-main",{staticStyle:{height:"100%",padding:"0 20px"}},[i("UnionBoard",{ref:"unionBoard"})],1),i("el-footer",{staticClass:"footer"},[i("div",{staticStyle:{height:"30px","margin-bottom":"6px"}},[e._v(" 排序字段 "),i("el-select",{staticStyle:{width:"120px"},attrs:{size:"mini"},model:{value:e.sortType,callback:function(t){e.sortType=t},expression:"sortType"}},[i("el-option",{attrs:{label:"数据源排序",value:"database"}}),i("el-option",{attrs:{label:"A-Z升序",value:"asc"}}),i("el-option",{attrs:{label:"A-Z降序",value:"desc"}}),i("el-option",{attrs:{label:"按表A-Z升序",value:"t-asc"}}),i("el-option",{attrs:{label:"按表A-Z降序",value:"t-desc"}})],1),i("div",{staticStyle:{display:"inline-block",float:"right"}},[i("el-checkbox",{attrs:{size:"mini"},model:{value:e.aliasVisible,callback:function(t){e.aliasVisible=t},expression:"aliasVisible"}},[e._v("显示别名")]),i("el-input",{staticStyle:{margin:"0 5px 0 20px",width:"80px"},attrs:{size:"mini"},model:{value:e.rowCount,callback:function(t){e.rowCount=t},expression:"rowCount"}}),e._v("行 ")],1)],1),i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.unionTableData,stripe:"",border:""}},e._l(e.unionTableCols,(function(e){return i("el-table-column",{key:e.name,attrs:{prop:e.name,label:e.alias}})})),1)],1)],1)},o=[],a=i("5530"),l=i("5880"),r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"union-box",on:{dragenter:function(t){return t.stopPropagation(),t.preventDefault(),e.onDragEnter(t)},dragover:function(t){return t.stopPropagation(),t.preventDefault(),e.onDragOver(t)},dragleave:function(t){return t.stopPropagation(),t.preventDefault(),e.onDragLeave(t)},drop:function(t){return t.stopPropagation(),t.preventDefault(),e.onDrop(t)}}},[i("svg-icon",{attrs:{"icon-class":"filter-line","class-name":"ds-filter"},on:{click:function(t){e.dialogVisible=!0}}}),e._l(e.dataSourceNodes,(function(t){return i("div",{key:"union-box-"+t.id,staticClass:"node-box",style:"left:"+t.position.x+"px;top:"+t.position.y+"px"},[i("el-popover",{directives:[{name:"show",rawName:"v-show",value:!t.root,expression:"!node.root"}],attrs:{placement:"bottom",width:"360",trigger:"click"},on:{"hook:updated":function(i){return e.onPopoverUpdated(t)}},model:{value:t.settersvisible,callback:function(i){e.$set(t,"settersvisible",i)},expression:"node.settersvisible"}},[i("UnionPopover",{attrs:{type:t.unionType,"data-source":t.dataSource,conditions:t.conditions},on:{"update:type":function(i){return e.$set(t,"unionType",i)},"update:conditions":function(i){return e.$set(t,"conditions",i)},close:function(i){return e.onPopoverClose(t)}}}),i("UnionIcon",{key:"union"+t.id,staticClass:"union-icon",attrs:{slot:"reference",id:"union"+t.id,type:t.unionType,"have-union":t.conditions.length>0},slot:"reference"})],1),i("DataSourceBlock",{key:"block"+t.id,style:"width:"+e.blockWidth+"px",attrs:{id:"block"+t.id,title:t.alias},on:{close:function(i){return e.onNodeClose(t)}}})],1)})),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.dataSourceNodes.length,expression:"!dataSourceNodes.length"}],staticClass:"empty-info"},[e._v("拖入数据表进行组合关联")]),i("el-dialog",{attrs:{title:"自定义过滤条件",visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("h3",[e._v("有待实现,敬请期待...")]),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"mini"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.onFilterCommit()}}},[e._v("确定")])],1)])],2)},s=[],c=(i("159b"),i("99af"),i("b0c0"),i("a434"),i("4de4"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{style:"display:inline-block;position:relative;height:"+2*e.radius+"px"},[i("div",{style:[e.circle,e.circleLeft]}),i("div",{style:[e.circle,e.circleRight]}),i("div",{style:e.ovalClass}),e.haveUnion?e._e():i("i",{staticClass:"el-icon-warning-outline",staticStyle:{position:"absolute",left:"0",right:"0","z-index":"20",top:"-10px",color:"red"}})])}),d=[],u=(i("a9e3"),i("caad"),{props:{radius:{type:Number,default:10},type:{type:String,default:"inner-join"},haveUnion:{type:[Boolean||null],default:!0}},data:function(){return this.ovalRadio=.4,this.fillColor="#1890ff",this.defaultZIndex=10,{}},computed:{circle:function(){return{"box-sizing":"border-box",width:"".concat(2*this.radius,"px"),height:"".concat(2*this.radius,"px"),"border-radius":"".concat(this.radius,"px"),border:"1.5px solid gray",display:"inline-block",background:"red","z-index":this.defaultZIndex,position:"relative"}},circleLeft:function(){var e=["left-join","all-join"].includes(this.type);return{"margin-right":"-".concat(this.radius*this.ovalRadio,"px"),background:e?this.fillColor:"transparent","z-index":e?0:this.defaultZIndex}},circleRight:function(){var e=["right-join","all-join"].includes(this.type);return{"margin-left":"-".concat(this.radius*this.ovalRadio,"px"),background:e?this.fillColor:"","z-index":e?0:this.defaultZIndex}},ovalClass:function(){var e=this.ovalRadio*this.radius,t=Math.sqrt(Math.pow(this.radius,2)-Math.pow(this.radius-e,2));return t=Math.ceil(t),["inner-join","all-join"].includes(this.type)?{"box-sizing":"border-box",width:"".concat(2*e,"px"),height:"".concat(2*t,"px"),border:"1.5px solid gray",background:"#1890ff","border-radius":"".concat(e,"px / ").concat(t,"px"),display:"inline-block",position:"absolute",left:"0px",right:"0px",top:"0px",bottom:"0px",margin:"auto auto","z-index":this.defaultZIndex+1}:"display:hidden"}}}),p=u,h=(i("73ac"),i("2877")),f=Object(h["a"])(p,c,d,!1,null,"6e470edd",null),v=f.exports,b=function(){var e=this,t=this,i=t.$createElement,n=t._self._c||i;return n("section",[n("div",{staticStyle:{height:"18px",margin:"5px 0","font-size":"16px"}},[t._v(" 关联 "),n("span",{staticStyle:{"font-size":"9px"}},[t._v("(双击行编辑关联条件)")]),n("div",{staticClass:"el-icon-close",staticStyle:{position:"relative",float:"right",right:"-7px",top:"-7px"},on:{click:function(){return e.$emit("close")}}})]),n("div",t._l(t.unionTypeList,(function(e){return n("div",{key:e.type,class:{"union-item":!0,"union-selected":t.selectUnionType===e.type},on:{click:function(i){t.selectUnionType=e.type}}},[n("UnionIcon",{staticClass:"union-type",attrs:{type:e.type}}),n("div",[t._v(t._s(e.label))])],1)})),0),n("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,size:"mini",border:"",stripe:""}},[n("el-table-column",{attrs:{prop:"leftField",label:t.dataSource.preSheetLabel,"min-width":"36%"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.editable?n("el-select",{staticStyle:{border:"0px"},attrs:{size:"mini",filterable:""},on:{change:t.onSelectChanged},model:{value:e.row.leftField,callback:function(i){t.$set(e.row,"leftField",i)},expression:"scope.row.leftField"}},t._l(t.leftFieldList,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.name}})})),1):n("div",{staticStyle:{width:"100%","min-height":"28px","padding-left":"5px"},on:{dblclick:function(){return e.row.editable=!0}}},[t._v(t._s(e.row.leftField))])]}}])}),n("el-table-column",{attrs:{prop:"operator",label:"操作符","min-width":"28%"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.editable?n("el-select",{staticStyle:{border:"0px"},attrs:{size:"mini",filterable:""},model:{value:e.row.operator,callback:function(i){t.$set(e.row,"operator",i)},expression:"scope.row.operator"}},t._l(t.operatorList,(function(e){return n("el-option",{key:e,attrs:{label:e,value:e}})})),1):n("div",{staticStyle:{width:"100%","min-height":"28px","text-align":"center"},on:{dblclick:function(){return e.row.editable=!0}}},[t._v(t._s(e.row.operator))])]}}])}),n("el-table-column",{attrs:{prop:"rightField",label:t.dataSource.sheetLabel,"min-width":"36%"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.editable?n("el-select",{staticStyle:{border:"0px"},attrs:{size:"mini",filterable:""},on:{change:t.onSelectChanged},model:{value:e.row.rightField,callback:function(i){t.$set(e.row,"rightField",i)},expression:"scope.row.rightField"}},t._l(t.rightFieldList,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.name}})})),1):n("div",{staticStyle:{width:"100%","min-height":"28px","padding-left":"5px"},on:{dblclick:function(){return e.row.editable=!0}}},[t._v(t._s(e.row.rightField))])]}}])})],1)],1)},g=[],m=(i("d81d"),i("fb6a"),i("37c9")),y={components:{UnionIcon:v},props:{type:{type:String,default:"inner-join"},conditions:{type:Array,default:function(){return[]}},dataSource:{type:Object,default:function(){}}},computed:{leftFieldValue:{get:function(){return null},set:function(e){}}},data:function(){return this.unionTypeList=[{type:"inner-join",label:"内部"},{type:"left-join",label:"左侧"},{type:"right-join",label:"右侧"},{type:"all-join",label:"完全外部"}],this.operatorList=["=","<>","<","<=",">",">="],{tableData:[],unionType:"inner-join",selectUnionType:null,leftFieldList:[{id:1,name:"aaaa"}],rightFieldList:[{id:2,name:"bbbbb"}]}},created:function(){var e,t;this.tableData=this.conditions.map((function(e){return Object(a["a"])(Object(a["a"])({},e),{},{editable:!1})})),this.tableData.push(this.createConditionRow()),this.leftFieldList=null===(e=m["a"].getAllFields(this.dataSource.preDsId,this.dataSource.preSheetName))||void 0===e?void 0:e.map((function(e){return{id:e,name:e}||[]})),this.rightFieldList=(null===(t=m["a"].getAllFields(this.dataSource.dsId,this.dataSource.sheetName))||void 0===t?void 0:t.map((function(e){return{id:e,name:e}})))||[]},methods:{createConditionRow:function(){return{leftField:null,operator:null,rightField:null,editable:!1}},onSelectChanged:function(e){}},watch:{tableData:{deep:!0,handler:function(e,t){if(!((null===e||void 0===e?void 0:e.length)<=0)){var i=e[e.length-1],n=null;i.leftField&&i.operator&&i.rightField?(i.editable=!1,e.push(this.createConditionRow()),n=e):n=e.slice(0,e.length-1),this.$emit("update:conditions",n)}}},selectUnionType:function(e,t){this.$emit("update:type",e)}}},x=y,S=(i("e470"),Object(h["a"])(x,b,g,!1,null,"dc3f0aea",null)),w=S.exports,k=function(){var e=this,t=this,i=t.$createElement,n=t._self._c||i;return n("div",{staticStyle:{display:"inline-block"}},[n("el-tag",{staticClass:"data-source-block",attrs:{closable:""},on:{close:function(){return e.$emit("close")}}},[n("div",{staticClass:"ds-alias"},[t._v(t._s(t.title))])])],1)},L=[],_={props:{title:{type:String,default:""}},data:function(){return{}}},C=_,T=(i("2cd6"),Object(h["a"])(C,k,L,!1,null,"20cfbc64",null)),N=T.exports,D=i("c45a"),j={components:{DataSourceBlock:N,UnionIcon:v,UnionPopover:w},data:function(){return this.blockHeight=26,this.blockWidth=160,this.unionIconWidth=92,this.lineOptions={color:"rgba(30, 130, 250, 0.5)",size:1,startPlug:"behind",startPlugSize:1,endPlug:"behind",endPlugSize:1},this.lineList=[],{dialogVisible:!1,dataSourceTree:[]}},computed:{dataSourceNodes:function(){return this.nodeTree2List(this.dataSourceTree)}},mounted:function(){this.canvas=document.querySelector("#ds-board-canvas"),this.initUnionTree([])},methods:{onPopoverUpdated:function(e){null===e.settersvisible&&(e.settersvisible=!e.root)},onPopoverClose:function(e){e.settersvisible=!1},initUnionTree:function(e){this.drawAllNodeLines(e)},nodeTree2List:function(e){var t=this,i=[];return null===e||void 0===e||e.forEach((function(e){var n;i.push(e),(null===(n=e.relations)||void 0===n?void 0:n.length)>0&&(i=i.concat(t.nodeTree2List(e.relations)))})),i},createDsNode:function(e,t){var i=0,n=0;if(t){var o,a;i=(null===(o=t.position)||void 0===o?void 0:o.x)+this.blockWidth+(t.root?0:this.unionIconWidth);var l,r=null===(a=t.relations)||void 0===a?void 0:a.length;if(0===r)n=null===(l=t.position)||void 0===l?void 0:l.y;else n=t.relations[r-1].y+this.blockHeight}return{id:Object(D["b"])(),parentId:null===t||void 0===t?void 0:t.id,name:e.name,alias:e.label,unionType:"",settersvisible:null,position:{x:i||10,y:n||10},dataSource:{preDsId:null===t||void 0===t?void 0:t.dataSource.dsId,preDsName:null===t||void 0===t?void 0:t.dataSource.dsName,preSheetName:null===t||void 0===t?void 0:t.dataSource.sheetName,preSheetLabel:null===t||void 0===t?void 0:t.dataSource.sheetLabel,dsId:e.dsId,dsName:e.dsName,sheetName:e.name,sheetLabel:e.label},conditions:[],filter:[],relations:[]}},getUnionTargetNode:function(e,t){var i,n=null;return null===(i=this.dataSourceNodes)||void 0===i||i.forEach((function(i){i.position.y<t&&(n=n||i,i.position.y>n.position.y&&(n=i)),n&&i.position.x<e&&i.position.x>n.position.x&&(n=i)})),n},onNodeClose:function(e){var t=this,i=function e(t,i){var n;if(null===(n=t)||void 0===n||!n.length)return!1;for(var o=0;o<t.length;o++){var a=t[o];return a.id===i.id?(t=t.splice(o,1),!0):e(a.relations,i)}};i(this.dataSourceTree,e);var n=function e(i){var n,o,a=null===(n=t.lineList)||void 0===n?void 0:n.filter((function(e){return e.beginEleId==i.parentId&&e.endEleId===i.id}));null===a||void 0===a||a.forEach((function(e){e.line.remove()})),null===(o=i.relations)||void 0===o||o.forEach((function(t){return e(t)}))};n(e)},onDrop:function(e){var t=this,i=e.dataTransfer.getData("dataSourceSheet");if(i){var n=e.offsetX||e.layerX,o=e.offsetY||e.layerY,a=JSON.parse(i),l=this.getUnionTargetNode(n,o),r=this.createDsNode(a,l);l&&l.relations.push(r);var s=this.dataSourceNodes.length<=0;s?(r.root=!0,this.dataSourceTree.push(r)):this.$nextTick((function(){t.drawNodeLine(l.id,r.id)}))}},onDragEnter:function(e){},onDragOver:function(e){},onDragLeave:function(e){},close:function(){this.clearLines()},drawAllNodeLines:function(e){var t=this;this.clearLines(),null===e||void 0===e||e.forEach((function(e){var i,n;(null===(i=e.relations)||void 0===i?void 0:i.length)>0&&(null===(n=e.relations)||void 0===n||n.forEach((function(i){t.drawLine(e.id,i.id)})))}))},drawNodeLine:function(e,t){var i=document.querySelector("#block"+e),n=document.querySelector("#union"+t),o=document.querySelector("#block"+t);if(i&&n){var a=new LeaderLine(i,n,this.lineOptions);this.lineList.push({beginEleId:e,endEleId:t,line:a})}if(n&&o){var l=new LeaderLine(n,o,this.lineOptions);this.lineList.push({beginEleId:e,endEleId:t,line:l})}},clearLines:function(){try{var e;null===(e=this.lineList)||void 0===e||e.forEach((function(e){e.line.remove()})),this.lineList=[]}catch(t){this.$message.error(null===t||void 0===t?void 0:t.message)}},drawCanvasLine:function(e,t,i){var n=this.canvas.getContext("2d"),o={strokeStyle:"#e6c7ff",lineWidth:2};Object.assign(n,o,i),n.beginPath(),n.moveTo(e[0],e[1]),n.lineTo(t[0],t[1]),n.stroke()},onFilterCommit:function(){this.dialogVisible=!1}}},F=j,I=(i("334b"),Object(h["a"])(F,r,s,!1,null,"f8855f36",null)),z=I.exports,U={components:{UnionBoard:z},data:function(){return{aliasVisible:!0,rowCount:16,sortType:"database",unionTableData:[{col1:"1",col2:"2"}],unionTableCols:[{name:"col1",label:"列1",alias:"列1"},{name:"col2",label:"列2",alias:"列2"}]}},created:function(){},methods:Object(a["a"])(Object(a["a"])({},Object(l["mapActions"])("settings",["changeSettings"])),{},{onClose:function(){this.$refs.unionBoard.close(),this.changeSettings({dataSourceUnion:!1})}})},E=U,O=(i("aa90"),Object(h["a"])(E,n,o,!1,null,"2cec5ff1",null));t["default"]=O.exports},"45cc":function(e,t,i){},"73ac":function(e,t,i){"use strict";i("45cc")},7496:function(e,t,i){},"97d6":function(e,t,i){},aa90:function(e,t,i){"use strict";i("afd5")},afd5:function(e,t,i){},e470:function(e,t,i){"use strict";i("1561")}}]);