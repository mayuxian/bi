(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-71b8ce94"],{1561:function(t,e,i){},"2cd6":function(t,e,i){"use strict";i("7496")},"334b":function(t,e,i){"use strict";i("97d6")},4155:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-container",{staticClass:"union-box"},[i("el-header",{staticStyle:{padding:"0px",height:"auto","margin-bottom":"2px"}},[i("h2",{staticStyle:{display:"inline-block"}},[t._v("数据创建连接")]),i("el-button",{staticStyle:{display:"inline-block","margin-left":"20px"},attrs:{size:"small",type:"primary"},on:{click:t.onClose}},[t._v("关闭")])],1),i("el-main",{staticStyle:{height:"100%",padding:"0 20px"}},[i("UnionBoard",{ref:"unionBoard"})],1),i("el-footer",{staticClass:"footer"},[i("div",{staticStyle:{height:"30px","margin-bottom":"6px"}},[t._v(" 排序字段 "),i("el-select",{staticStyle:{width:"120px"},attrs:{size:"mini"},model:{value:t.sortType,callback:function(e){t.sortType=e},expression:"sortType"}},[i("el-option",{attrs:{label:"数据源排序",value:"database"}}),i("el-option",{attrs:{label:"A-Z升序",value:"asc"}}),i("el-option",{attrs:{label:"A-Z降序",value:"desc"}}),i("el-option",{attrs:{label:"按表A-Z升序",value:"t-asc"}}),i("el-option",{attrs:{label:"按表A-Z降序",value:"t-desc"}})],1),i("div",{staticStyle:{display:"inline-block",float:"right"}},[i("el-checkbox",{attrs:{size:"mini"},model:{value:t.aliasVisible,callback:function(e){t.aliasVisible=e},expression:"aliasVisible"}},[t._v("显示别名")]),i("el-input",{staticStyle:{margin:"0 5px 0 20px",width:"80px"},attrs:{size:"mini"},model:{value:t.rowCount,callback:function(e){t.rowCount=e},expression:"rowCount"}}),t._v("行 ")],1)],1),i("el-table",{staticStyle:{width:"100%"},attrs:{stripe:"",border:""}})],1)],1)},o=[],a=i("5530"),l=i("5880"),r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"union-box",on:{dragenter:function(e){return e.stopPropagation(),e.preventDefault(),t.onDragEnter(e)},dragover:function(e){return e.stopPropagation(),e.preventDefault(),t.onDragOver(e)},dragleave:function(e){return e.stopPropagation(),e.preventDefault(),t.onDragLeave(e)},drop:function(e){return e.stopPropagation(),e.preventDefault(),t.onDrop(e)}}},[i("svg-icon",{attrs:{"icon-class":"filter-line","class-name":"ds-filter"},on:{click:function(e){t.dialogVisible=!0}}}),t._l(t.dataSourceNodes,(function(e){return i("div",{key:"union-box-"+e.id,staticClass:"node-box",style:"left:"+e.position.x+"px;top:"+e.position.y+"px"},[i("el-popover",{directives:[{name:"show",rawName:"v-show",value:!e.root,expression:"!node.root"}],attrs:{placement:"bottom",width:"360",trigger:"click"},on:{"hook:updated":function(i){return t.onPopoverUpdated(e)}},model:{value:e.settersvisible,callback:function(i){t.$set(e,"settersvisible",i)},expression:"node.settersvisible"}},[i("UnionPopover",{attrs:{type:e.unionType,"data-source":e.dataSource,conditions:e.conditions},on:{"update:type":function(i){return t.$set(e,"unionType",i)},"update:conditions":function(i){return t.$set(e,"conditions",i)},close:function(i){return t.onPopoverClose(e)}}}),i("UnionIcon",{key:"union"+e.id,staticClass:"union-icon",attrs:{slot:"reference",id:"union"+e.id,type:e.unionType,"have-union":e.conditions.length>0},slot:"reference"})],1),i("DataSourceBlock",{key:"block"+e.id,style:"width:"+t.blockWidth+"px",attrs:{id:"block"+e.id,title:e.alias},on:{close:function(i){return t.onNodeClose(e)}}})],1)})),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.dataSourceNodes.length,expression:"!dataSourceNodes.length"}],staticClass:"empty-info"},[t._v("拖入数据表进行组合关联")]),i("el-dialog",{attrs:{title:"自定义过滤条件",visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("h3",[t._v("有待实现,敬请期待...")]),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"mini"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")]),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.onFilterCommit()}}},[t._v("确定")])],1)])],2)},s=[],c=(i("159b"),i("99af"),i("b0c0"),i("a434"),i("4de4"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{style:"display:inline-block;position:relative;height:"+2*t.radius+"px"},[i("div",{style:[t.circle,t.circleLeft]}),i("div",{style:[t.circle,t.circleRight]}),i("div",{style:t.ovalClass}),t.haveUnion?t._e():i("i",{staticClass:"el-icon-warning-outline",staticStyle:{position:"absolute",left:"0",right:"0","z-index":"20",top:"-10px",color:"red"}})])}),d=[],u=(i("a9e3"),i("caad"),{props:{radius:{type:Number,default:10},type:{type:String,default:"inner-join"},haveUnion:{type:[Boolean||null],default:!0}},data:function(){return this.ovalRadio=.4,this.fillColor="#1890ff",this.defaultZIndex=10,{}},computed:{circle:function(){return{"box-sizing":"border-box",width:"".concat(2*this.radius,"px"),height:"".concat(2*this.radius,"px"),"border-radius":"".concat(this.radius,"px"),border:"1.5px solid gray",display:"inline-block",background:"red","z-index":this.defaultZIndex,position:"relative"}},circleLeft:function(){var t=["left-join","all-join"].includes(this.type);return{"margin-right":"-".concat(this.radius*this.ovalRadio,"px"),background:t?this.fillColor:"transparent","z-index":t?0:this.defaultZIndex}},circleRight:function(){var t=["right-join","all-join"].includes(this.type);return{"margin-left":"-".concat(this.radius*this.ovalRadio,"px"),background:t?this.fillColor:"","z-index":t?0:this.defaultZIndex}},ovalClass:function(){var t=this.ovalRadio*this.radius,e=Math.sqrt(Math.pow(this.radius,2)-Math.pow(this.radius-t,2));return e=Math.ceil(e),["inner-join","all-join"].includes(this.type)?{"box-sizing":"border-box",width:"".concat(2*t,"px"),height:"".concat(2*e,"px"),border:"1.5px solid gray",background:"#1890ff","border-radius":"".concat(t,"px / ").concat(e,"px"),display:"inline-block",position:"absolute",left:"0px",right:"0px",top:"0px",bottom:"0px",margin:"auto auto","z-index":this.defaultZIndex+1}:"display:hidden"}}}),p=u,h=(i("73ac"),i("2877")),f=Object(h["a"])(p,c,d,!1,null,"6e470edd",null),v=f.exports,b=function(){var t=this,e=this,i=e.$createElement,n=e._self._c||i;return n("section",[n("div",{staticStyle:{height:"18px",margin:"5px 0","font-size":"16px"}},[e._v(" 关联 "),n("span",{staticStyle:{"font-size":"9px"}},[e._v("(双击行编辑关联条件)")]),n("div",{staticClass:"el-icon-close",staticStyle:{position:"relative",float:"right",right:"-7px",top:"-7px"},on:{click:function(){return t.$emit("close")}}})]),n("div",e._l(e.unionTypeList,(function(t){return n("div",{key:t.type,class:{"union-item":!0,"union-selected":e.selectUnionType===t.type},on:{click:function(i){e.selectUnionType=t.type}}},[n("UnionIcon",{staticClass:"union-type",attrs:{type:t.type}}),n("div",[e._v(e._s(t.label))])],1)})),0),n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,size:"mini",border:"",stripe:""}},[n("el-table-column",{attrs:{prop:"leftField",label:e.dataSource.preSheetLabel,"min-width":"36%"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.editable?n("el-select",{staticStyle:{border:"0px"},attrs:{size:"mini",filterable:""},on:{change:e.onSelectChanged},model:{value:t.row.leftField,callback:function(i){e.$set(t.row,"leftField",i)},expression:"scope.row.leftField"}},e._l(e.leftFieldList,(function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.name}})})),1):n("div",{staticStyle:{width:"100%","min-height":"28px","padding-left":"5px"},on:{dblclick:function(){return t.row.editable=!0}}},[e._v(e._s(t.row.leftField))])]}}])}),n("el-table-column",{attrs:{prop:"operator",label:"操作符","min-width":"28%"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.editable?n("el-select",{staticStyle:{border:"0px"},attrs:{size:"mini",filterable:""},model:{value:t.row.operator,callback:function(i){e.$set(t.row,"operator",i)},expression:"scope.row.operator"}},e._l(e.operatorList,(function(t){return n("el-option",{key:t,attrs:{label:t,value:t}})})),1):n("div",{staticStyle:{width:"100%","min-height":"28px","text-align":"center"},on:{dblclick:function(){return t.row.editable=!0}}},[e._v(e._s(t.row.operator))])]}}])}),n("el-table-column",{attrs:{prop:"rightField",label:e.dataSource.sheetLabel,"min-width":"36%"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.editable?n("el-select",{staticStyle:{border:"0px"},attrs:{size:"mini",filterable:""},on:{change:e.onSelectChanged},model:{value:t.row.rightField,callback:function(i){e.$set(t.row,"rightField",i)},expression:"scope.row.rightField"}},e._l(e.rightFieldList,(function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.name}})})),1):n("div",{staticStyle:{width:"100%","min-height":"28px","padding-left":"5px"},on:{dblclick:function(){return t.row.editable=!0}}},[e._v(e._s(t.row.rightField))])]}}])})],1)],1)},g=[],y=(i("d81d"),i("fb6a"),i("37c9")),m={components:{UnionIcon:v},props:{type:{type:String,default:"inner-join"},conditions:{type:Array,default:function(){return[]}},dataSource:{type:Object,default:function(){}}},computed:{leftFieldValue:{get:function(){return null},set:function(t){}}},data:function(){return this.unionTypeList=[{type:"inner-join",label:"内部"},{type:"left-join",label:"左侧"},{type:"right-join",label:"右侧"},{type:"all-join",label:"完全外部"}],this.operatorList=["=","<>","<","<=",">",">="],{tableData:[],unionType:"inner-join",selectUnionType:null,leftFieldList:[{id:1,name:"aaaa"}],rightFieldList:[{id:2,name:"bbbbb"}]}},created:function(){var t,e;this.tableData=this.conditions.map((function(t){return Object(a["a"])(Object(a["a"])({},t),{},{editable:!1})})),this.tableData.push(this.createConditionRow()),this.leftFieldList=null===(t=y["a"].getAllFields(this.dataSource.preDsId,this.dataSource.preSheetName))||void 0===t?void 0:t.map((function(t){return{id:t,name:t}||[]})),this.rightFieldList=(null===(e=y["a"].getAllFields(this.dataSource.dsId,this.dataSource.sheetName))||void 0===e?void 0:e.map((function(t){return{id:t,name:t}})))||[]},methods:{createConditionRow:function(){return{leftField:null,operator:null,rightField:null,editable:!1}},onSelectChanged:function(t){}},watch:{tableData:{deep:!0,handler:function(t,e){if(!((null===t||void 0===t?void 0:t.length)<=0)){var i=t[t.length-1],n=null;i.leftField&&i.operator&&i.rightField?(i.editable=!1,t.push(this.createConditionRow()),n=t):n=t.slice(0,t.length-1),this.$emit("update:conditions",n)}}},selectUnionType:function(t,e){this.$emit("update:type",t)}}},x=m,S=(i("e470"),Object(h["a"])(x,b,g,!1,null,"dc3f0aea",null)),w=S.exports,k=function(){var t=this,e=this,i=e.$createElement,n=e._self._c||i;return n("div",{staticStyle:{display:"inline-block"}},[n("el-tag",{staticClass:"data-source-block",attrs:{closable:""},on:{close:function(){return t.$emit("close")}}},[n("div",{staticClass:"ds-alias"},[e._v(e._s(e.title))])])],1)},L=[],_={props:{title:{type:String,default:""}},data:function(){return{}}},C=_,T=(i("2cd6"),Object(h["a"])(C,k,L,!1,null,"20cfbc64",null)),N=T.exports,j=i("c45a"),D={components:{DataSourceBlock:N,UnionIcon:v,UnionPopover:w},data:function(){return this.blockHeight=26,this.blockWidth=160,this.unionIconWidth=92,this.lineOptions={color:"rgba(30, 130, 250, 0.5)",size:1,startPlug:"behind",startPlugSize:1,endPlug:"behind",endPlugSize:1},this.lineList=[],{dialogVisible:!1,dataSourceTree:[]}},computed:{dataSourceNodes:function(){return this.nodeTree2List(this.dataSourceTree)}},mounted:function(){this.canvas=document.querySelector("#ds-board-canvas"),this.initUnionTree([])},methods:{onPopoverUpdated:function(t){null===t.settersvisible&&(t.settersvisible=!t.root)},onPopoverClose:function(t){t.settersvisible=!1},initUnionTree:function(t){this.drawAllNodeLines(t)},nodeTree2List:function(t){var e=this,i=[];return null===t||void 0===t||t.forEach((function(t){var n;i.push(t),(null===(n=t.relations)||void 0===n?void 0:n.length)>0&&(i=i.concat(e.nodeTree2List(t.relations)))})),i},createDsNode:function(t,e){var i=0,n=0;if(e){var o,a;i=(null===(o=e.position)||void 0===o?void 0:o.x)+this.blockWidth+(e.root?0:this.unionIconWidth);var l,r=null===(a=e.relations)||void 0===a?void 0:a.length;if(0===r)n=null===(l=e.position)||void 0===l?void 0:l.y;else n=e.relations[r-1].y+this.blockHeight}return{id:Object(j["a"])(),parentId:null===e||void 0===e?void 0:e.id,name:t.name,alias:t.label,unionType:"",settersvisible:null,position:{x:i||10,y:n||10},dataSource:{preDsId:null===e||void 0===e?void 0:e.dataSource.dsId,preDsName:null===e||void 0===e?void 0:e.dataSource.dsName,preSheetName:null===e||void 0===e?void 0:e.dataSource.sheetName,preSheetLabel:null===e||void 0===e?void 0:e.dataSource.sheetLabel,dsId:t.dsId,dsName:t.dsName,sheetName:t.name,sheetLabel:t.label},conditions:[],filter:[],relations:[]}},getUnionTargetNode:function(t,e){var i,n=null;return null===(i=this.dataSourceNodes)||void 0===i||i.forEach((function(i){i.position.y<e&&(n=n||i,i.position.y>n.position.y&&(n=i)),n&&i.position.x<t&&i.position.x>n.position.x&&(n=i)})),n},onNodeClose:function(t){var e=this,i=function t(e,i){var n;if(null===(n=e)||void 0===n||!n.length)return!1;for(var o=0;o<e.length;o++){var a=e[o];return a.id===i.id?(e=e.splice(o,1),!0):t(a.relations,i)}};i(this.dataSourceTree,t);var n=function t(i){var n,o,a=null===(n=e.lineList)||void 0===n?void 0:n.filter((function(t){return t.beginEleId==i.parentId&&t.endEleId===i.id}));null===a||void 0===a||a.forEach((function(t){t.line.remove()})),null===(o=i.relations)||void 0===o||o.forEach((function(e){return t(e)}))};n(t)},onDrop:function(t){var e=this,i=t.dataTransfer.getData("dataSourceSheet");if(i){var n=t.offsetX||t.layerX,o=t.offsetY||t.layerY,a=JSON.parse(i),l=this.getUnionTargetNode(n,o),r=this.createDsNode(a,l);l&&l.relations.push(r);var s=this.dataSourceNodes.length<=0;s?(r.root=!0,this.dataSourceTree.push(r)):this.$nextTick((function(){e.drawNodeLine(l.id,r.id)}))}},onDragEnter:function(t){},onDragOver:function(t){},onDragLeave:function(t){},close:function(){this.clearLines()},drawAllNodeLines:function(t){var e=this;this.clearLines(),null===t||void 0===t||t.forEach((function(t){var i,n;(null===(i=t.relations)||void 0===i?void 0:i.length)>0&&(null===(n=t.relations)||void 0===n||n.forEach((function(i){e.drawLine(t.id,i.id)})))}))},drawNodeLine:function(t,e){var i=document.querySelector("#block"+t),n=document.querySelector("#union"+e),o=document.querySelector("#block"+e);if(i&&n){var a=new LeaderLine(i,n,this.lineOptions);this.lineList.push({beginEleId:t,endEleId:e,line:a})}if(n&&o){var l=new LeaderLine(n,o,this.lineOptions);this.lineList.push({beginEleId:t,endEleId:e,line:l})}},clearLines:function(){try{var t;null===(t=this.lineList)||void 0===t||t.forEach((function(t){t.line.remove()})),this.lineList=[]}catch(e){this.$message.error(null===e||void 0===e?void 0:e.message)}},drawCanvasLine:function(t,e,i){var n=this.canvas.getContext("2d"),o={strokeStyle:"#e6c7ff",lineWidth:2};Object.assign(n,o,i),n.beginPath(),n.moveTo(t[0],t[1]),n.lineTo(e[0],e[1]),n.stroke()},onFilterCommit:function(){this.dialogVisible=!1}}},F=D,I=(i("334b"),Object(h["a"])(F,r,s,!1,null,"f8855f36",null)),z=I.exports,U={components:{UnionBoard:z},data:function(){return{aliasVisible:!0,rowCount:16,sortType:"database"}},created:function(){},methods:Object(a["a"])(Object(a["a"])({},Object(l["mapActions"])("settings",["changeSettings"])),{},{onClose:function(){this.$refs.unionBoard.close(),this.changeSettings({dataSourceUnion:!1})}})},E=U,O=(i("6998"),Object(h["a"])(E,n,o,!1,null,"40050d16",null));e["default"]=O.exports},"45cc":function(t,e,i){},6998:function(t,e,i){"use strict";i("849b")},"73ac":function(t,e,i){"use strict";i("45cc")},7496:function(t,e,i){},"849b":function(t,e,i){},"97d6":function(t,e,i){},e470:function(t,e,i){"use strict";i("1561")}}]);
//# sourceMappingURL=chunk-71b8ce94.5f01d196.js.map