{"version":3,"sources":["webpack:///./src/views/bi/components/data-source-union/DataSourceBlock.vue?6a84","webpack:///./src/views/bi/components/data-source-union/UnionBoard.vue?cb4e","webpack:///./src/views/bi/components/data-source-union/index.vue?eae3","webpack:///./src/views/bi/components/data-source-union/UnionBoard.vue?fce2","webpack:///./src/views/bi/components/data-source-union/UnionIcon.vue?f0c3","webpack:///src/views/bi/components/data-source-union/UnionIcon.vue","webpack:///./src/views/bi/components/data-source-union/UnionIcon.vue?a54c","webpack:///./src/views/bi/components/data-source-union/UnionIcon.vue","webpack:///./src/views/bi/components/data-source-union/UnionPopover.vue?43cf","webpack:///src/views/bi/components/data-source-union/UnionPopover.vue","webpack:///./src/views/bi/components/data-source-union/UnionPopover.vue?d29b","webpack:///./src/views/bi/components/data-source-union/UnionPopover.vue","webpack:///./src/views/bi/components/data-source-union/DataSourceBlock.vue?0d3a","webpack:///src/views/bi/components/data-source-union/DataSourceBlock.vue","webpack:///./src/views/bi/components/data-source-union/DataSourceBlock.vue?fdc0","webpack:///./src/views/bi/components/data-source-union/DataSourceBlock.vue","webpack:///src/views/bi/components/data-source-union/UnionBoard.vue","webpack:///./src/views/bi/components/data-source-union/UnionBoard.vue?b809","webpack:///./src/views/bi/components/data-source-union/UnionBoard.vue","webpack:///src/views/bi/components/data-source-union/index.vue","webpack:///./src/views/bi/components/data-source-union/index.vue?2bc5","webpack:///./src/views/bi/components/data-source-union/index.vue","webpack:///./src/views/bi/components/data-source-union/index.vue?ef39","webpack:///./src/views/bi/components/data-source-union/UnionIcon.vue?ac54","webpack:///./src/views/bi/components/data-source-union/UnionPopover.vue?df0e"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","staticStyle","_v","attrs","on","onClose","ref","model","value","callback","$$v","sortType","expression","aliasVisible","rowCount","staticRenderFns","$event","stopPropagation","preventDefault","onDragEnter","onDragOver","onDragLeave","onDrop","dialogVisible","_l","node","key","id","style","position","directives","name","rawName","root","onPopoverUpdated","$set","unionType","dataSource","conditions","onPopoverClose","length","slot","blockWidth","alias","onNodeClose","dataSourceNodes","onFilterCommit","radius","circle","circleLeft","circleRight","haveUnion","_e","props","type","Number","default","String","Boolean","data","ovalRadio","fillColor","defaultZIndex","computed","width","height","border","display","background","visible","ovalClass","ovalHeightRadius","Math","ceil","includes","component","this$1","$emit","item","class","selectUnionType","_s","label","tableData","preSheetLabel","scopedSlots","_u","fn","scope","row","editable","onSelectChanged","leftField","val","operator","sheetLabel","rightField","components","UnionIcon","Array","Object","leftFieldValue","get","set","unionTypeList","operatorList","leftFieldList","rightFieldList","created","map","push","createConditionRow","methods","watch","deep","handler","lastRow","newVal","slice","title","DataSourceBlock","UnionPopover","blockHeight","unionIconWidth","lineOptions","color","size","startPlug","startPlugSize","endPlug","endPlugSize","lineList","dataSourceTree","nodeTree2List","mounted","canvas","document","querySelector","initUnionTree","settersvisible","drawAllNodeLines","tree","list","leaf","concat","createDsNode","unionTargetNode","posX","childCount","posY","relations","y","parentId","sheet","x","preDsId","preDsName","preSheetName","dsId","dsName","sheetName","filter","getUnionTargetNode","unionNode","curNode","childNode","nodeList","splice","i","delNode","matchLines","line","remove","delLine","sheetStr","newNode","isRoot","$nextTick","close","clearLines","nodeTree","drawNodeLine","preEle","unionEle","beginEleId","nodeId","endEleId","nextNodeId","nextEle","$message","error","err","drawCanvasLine","strokeStyle","lineWidth","assign","context","_options","options","beginPath","moveTo","startPoi","lineTo","endPoi","stroke","UnionBoard","$refs","unionBoard","changeSettings"],"mappings":"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","file":"static/js/chunk-71b8ce94.5f01d196.js","sourcesContent":["export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../../../node_modules/stylus-loader/index.js??ref--11-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DataSourceBlock.vue?vue&type=style&index=0&id=20cfbc64&lang=stylus&scoped=true&\"","export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../../../node_modules/stylus-loader/index.js??ref--11-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UnionBoard.vue?vue&type=style&index=0&id=f8855f36&lang=stylus&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('el-container',{staticClass:\"union-box\"},[_c('el-header',{staticStyle:{\"padding\":\"0px\",\"height\":\"auto\",\"margin-bottom\":\"2px\"}},[_c('h2',{staticStyle:{\"display\":\"inline-block\"}},[_vm._v(\"数据创建连接\")]),_c('el-button',{staticStyle:{\"display\":\"inline-block\",\"margin-left\":\"20px\"},attrs:{\"size\":\"small\",\"type\":\"primary\"},on:{\"click\":_vm.onClose}},[_vm._v(\"关闭\")])],1),_c('el-main',{staticStyle:{\"height\":\"100%\",\"padding\":\"0 20px\"}},[_c('UnionBoard',{ref:\"unionBoard\"})],1),_c('el-footer',{staticClass:\"footer\"},[_c('div',{staticStyle:{\"height\":\"30px\",\"margin-bottom\":\"6px\"}},[_vm._v(\" 排序字段 \"),_c('el-select',{staticStyle:{\"width\":\"120px\"},attrs:{\"size\":\"mini\"},model:{value:(_vm.sortType),callback:function ($$v) {_vm.sortType=$$v},expression:\"sortType\"}},[_c('el-option',{attrs:{\"label\":\"数据源排序\",\"value\":\"database\"}}),_c('el-option',{attrs:{\"label\":\"A-Z升序\",\"value\":\"asc\"}}),_c('el-option',{attrs:{\"label\":\"A-Z降序\",\"value\":\"desc\"}}),_c('el-option',{attrs:{\"label\":\"按表A-Z升序\",\"value\":\"t-asc\"}}),_c('el-option',{attrs:{\"label\":\"按表A-Z降序\",\"value\":\"t-desc\"}})],1),_c('div',{staticStyle:{\"display\":\"inline-block\",\"float\":\"right\"}},[_c('el-checkbox',{attrs:{\"size\":\"mini\"},model:{value:(_vm.aliasVisible),callback:function ($$v) {_vm.aliasVisible=$$v},expression:\"aliasVisible\"}},[_vm._v(\"显示别名\")]),_c('el-input',{staticStyle:{\"margin\":\"0 5px 0 20px\",\"width\":\"80px\"},attrs:{\"size\":\"mini\"},model:{value:(_vm.rowCount),callback:function ($$v) {_vm.rowCount=$$v},expression:\"rowCount\"}}),_vm._v(\"行 \")],1)],1),_c('el-table',{staticStyle:{\"width\":\"100%\"},attrs:{\"stripe\":\"\",\"border\":\"\"}})],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"union-box\",on:{\"dragenter\":function($event){$event.stopPropagation();$event.preventDefault();return _vm.onDragEnter($event)},\"dragover\":function($event){$event.stopPropagation();$event.preventDefault();return _vm.onDragOver($event)},\"dragleave\":function($event){$event.stopPropagation();$event.preventDefault();return _vm.onDragLeave($event)},\"drop\":function($event){$event.stopPropagation();$event.preventDefault();return _vm.onDrop($event)}}},[_c('svg-icon',{attrs:{\"icon-class\":\"filter-line\",\"class-name\":\"ds-filter\"},on:{\"click\":function($event){_vm.dialogVisible=true}}}),_vm._l((_vm.dataSourceNodes),function(node){return _c('div',{key:'union-box-'+node.id,staticClass:\"node-box\",style:((\"left:\" + (node.position.x) + \"px;top:\" + (node.position.y) + \"px\"))},[_c('el-popover',{directives:[{name:\"show\",rawName:\"v-show\",value:(!node.root),expression:\"!node.root\"}],attrs:{\"placement\":\"bottom\",\"width\":\"360\",\"trigger\":\"click\"},on:{\"hook:updated\":function($event){return _vm.onPopoverUpdated(node)}},model:{value:(node.settersvisible),callback:function ($$v) {_vm.$set(node, \"settersvisible\", $$v)},expression:\"node.settersvisible\"}},[_c('UnionPopover',{attrs:{\"type\":node.unionType,\"data-source\":node.dataSource,\"conditions\":node.conditions},on:{\"update:type\":function($event){return _vm.$set(node, \"unionType\", $event)},\"update:conditions\":function($event){return _vm.$set(node, \"conditions\", $event)},\"close\":function($event){return _vm.onPopoverClose(node)}}}),_c('UnionIcon',{key:'union'+node.id,staticClass:\"union-icon\",attrs:{\"slot\":\"reference\",\"id\":'union'+node.id,\"type\":node.unionType,\"have-union\":node.conditions.length>0},slot:\"reference\"})],1),_c('DataSourceBlock',{key:'block'+node.id,style:((\"width:\" + _vm.blockWidth + \"px\")),attrs:{\"id\":'block'+node.id,\"title\":node.alias},on:{\"close\":function($event){return _vm.onNodeClose(node)}}})],1)}),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(!_vm.dataSourceNodes.length),expression:\"!dataSourceNodes.length\"}],staticClass:\"empty-info\"},[_vm._v(\"拖入数据表进行组合关联\")]),_c('el-dialog',{attrs:{\"title\":\"自定义过滤条件\",\"visible\":_vm.dialogVisible},on:{\"update:visible\":function($event){_vm.dialogVisible=$event}}},[_c('h3',[_vm._v(\"有待实现,敬请期待...\")]),_c('div',{staticClass:\"dialog-footer\",attrs:{\"slot\":\"footer\"},slot:\"footer\"},[_c('el-button',{attrs:{\"size\":\"mini\"},on:{\"click\":function($event){_vm.dialogVisible=false}}},[_vm._v(\"取消\")]),_c('el-button',{attrs:{\"type\":\"primary\",\"size\":\"mini\"},on:{\"click\":function($event){return _vm.onFilterCommit()}}},[_vm._v(\"确定\")])],1)])],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{style:((\"display:inline-block;position:relative;height:\" + (_vm.radius*2) + \"px\"))},[_c('div',{style:([_vm.circle,_vm.circleLeft])}),_c('div',{style:([_vm.circle,_vm.circleRight])}),_c('div',{style:(_vm.ovalClass)}),(!_vm.haveUnion)?_c('i',{staticClass:\"el-icon-warning-outline\",staticStyle:{\"position\":\"absolute\",\"left\":\"0\",\"right\":\"0\",\"z-index\":\"20\",\"top\":\"-10px\",\"color\":\"red\"}}):_vm._e()])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div :style=\"`display:inline-block;position:relative;height:${radius*2}px`\">\r\n    <div :style=\"[circle,circleLeft]\"></div>\r\n    <div :style=\"[circle,circleRight]\"></div>\r\n    <div :style=\"ovalClass\"></div>\r\n    <i\r\n      v-if=\"!haveUnion\"\r\n      class=\"el-icon-warning-outline\"\r\n      style=\"position:absolute;left:0;right:0;z-index:20;top:-10px;color:red;\"\r\n    ></i>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  props: {\r\n    radius: {\r\n      type: Number,\r\n      default: 10,\r\n    },\r\n    type: {\r\n      type: String,\r\n      default: 'inner-join', //inner-join,left-join,right-join,all-join ,\r\n    },\r\n    haveUnion: {\r\n      type: [Boolean || undefined || null],\r\n      default: true,\r\n    },\r\n  },\r\n  data() {\r\n    this.ovalRadio = 0.4 //椭圆的占半径的比例\r\n    this.fillColor = '#1890ff'\r\n    this.defaultZIndex = 10\r\n    return {}\r\n  },\r\n  computed: {\r\n    circle() {\r\n      return {\r\n        'box-sizing': 'border-box',\r\n        width: `${this.radius * 2}px`,\r\n        height: `${this.radius * 2}px`,\r\n        'border-radius': `${this.radius}px`,\r\n        border: '1.5px solid gray',\r\n        display: 'inline-block',\r\n        background: 'red',\r\n        'z-index': this.defaultZIndex,\r\n        position: 'relative',\r\n      }\r\n    },\r\n    circleLeft() {\r\n      const visible = ['left-join', 'all-join'].includes(this.type)\r\n      return {\r\n        'margin-right': `-${this.radius * this.ovalRadio}px`,\r\n        background: visible ? this.fillColor : 'transparent',\r\n        'z-index': visible ? 0 : this.defaultZIndex,\r\n      }\r\n    },\r\n    circleRight() {\r\n      const visible = ['right-join', 'all-join'].includes(this.type)\r\n      return {\r\n        'margin-left': `-${this.radius * this.ovalRadio}px`,\r\n        background: visible ? this.fillColor : '',\r\n        'z-index': visible ? 0 : this.defaultZIndex,\r\n      }\r\n    },\r\n    ovalClass() {\r\n      const ovalWidthRadius = this.ovalRadio * this.radius //因为左右半圆各移动了 ovalRadio,所以椭圆半径无需除以2\r\n      //勾股定理: (1-ovalRadio/2) *radius的平方+椭圆height的平凡=radius的平方\r\n      let ovalHeightRadius = Math.sqrt(\r\n        Math.pow(this.radius, 2) - Math.pow(this.radius - ovalWidthRadius, 2)\r\n      )\r\n      ovalHeightRadius = Math.ceil(ovalHeightRadius) //乘2,是因为height只是一半高度\r\n      return !['inner-join', 'all-join'].includes(this.type)\r\n        ? 'display:hidden'\r\n        : {\r\n            'box-sizing': 'border-box',\r\n            width: `${ovalWidthRadius * 2}px`,\r\n            height: `${ovalHeightRadius * 2}px`,\r\n            border: '1.5px solid gray',\r\n            background: '#1890ff',\r\n            'border-radius': `${ovalWidthRadius}px / ${ovalHeightRadius}px`,\r\n            display: 'inline-block',\r\n            position: 'absolute',\r\n            left: '0px',\r\n            right: '0px',\r\n            top: '0px',\r\n            bottom: '0px',\r\n            margin: 'auto auto',\r\n            'z-index': this.defaultZIndex + 1,\r\n          }\r\n    },\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang='stylus' scoped>\r\n.union-icon-box\r\n  position: relative\r\n  margin: auto 0\r\n  top: 0px\r\n  bottom: 0px\r\n  right: 0px\r\n  left: 0px\r\n.circle-left\r\n  box-sizing: border-box\r\n  width: 100px\r\n  height: 100px\r\n  border-radius: 50px\r\n  margin-right: -20px\r\n  border: 1px solid gray\r\n  display: inline-block\r\n.circle-right\r\n  box-sizing: border-box\r\n  width: 100px\r\n  height: 100px\r\n  border-radius: 50px\r\n  margin-left: -20px\r\n  border: 1px solid gray\r\n  display: inline-block\r\n.oval\r\n  box-sizing: border-box\r\n  width: 40px\r\n  height: 80px\r\n  border: 1px solid gray\r\n  background: #1890ff\r\n  border-radius: 40px / 80px\r\n  display: inline-block\r\n  position: absolute\r\n  left: 0px\r\n  right: 0px\r\n  top: 0px\r\n  bottom: 0px\r\n  margin: auto auto\r\n</style>\r\n","import mod from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UnionIcon.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UnionIcon.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./UnionIcon.vue?vue&type=template&id=6e470edd&scoped=true&\"\nimport script from \"./UnionIcon.vue?vue&type=script&lang=js&\"\nexport * from \"./UnionIcon.vue?vue&type=script&lang=js&\"\nimport style0 from \"./UnionIcon.vue?vue&type=style&index=0&id=6e470edd&lang=stylus&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"6e470edd\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {\nvar this$1 = this;\nvar _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('section',[_c('div',{staticStyle:{\"height\":\"18px\",\"margin\":\"5px 0\",\"font-size\":\"16px\"}},[_vm._v(\" 关联 \"),_c('span',{staticStyle:{\"font-size\":\"9px\"}},[_vm._v(\"(双击行编辑关联条件)\")]),_c('div',{staticClass:\"el-icon-close\",staticStyle:{\"position\":\"relative\",\"float\":\"right\",\"right\":\"-7px\",\"top\":\"-7px\"},on:{\"click\":function (){ return this$1.$emit('close'); }}})]),_c('div',_vm._l((_vm.unionTypeList),function(item){return _c('div',{key:item.type,class:{'union-item':true,'union-selected':_vm.selectUnionType===item.type},on:{\"click\":function($event){_vm.selectUnionType=item.type}}},[_c('UnionIcon',{staticClass:\"union-type\",attrs:{\"type\":item.type}}),_c('div',[_vm._v(_vm._s(item.label))])],1)}),0),_c('el-table',{staticStyle:{\"width\":\"100%\"},attrs:{\"data\":_vm.tableData,\"size\":\"mini\",\"border\":\"\",\"stripe\":\"\"}},[_c('el-table-column',{attrs:{\"prop\":\"leftField\",\"label\":_vm.dataSource.preSheetLabel,\"min-width\":\"36%\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [(!scope.row.editable)?_c('div',{staticStyle:{\"width\":\"100%\",\"min-height\":\"28px\",\"padding-left\":\"5px\"},on:{\"dblclick\":function (){ return scope.row.editable=true; }}},[_vm._v(_vm._s(scope.row.leftField))]):_c('el-select',{staticStyle:{\"border\":\"0px\"},attrs:{\"size\":\"mini\",\"filterable\":\"\"},on:{\"change\":_vm.onSelectChanged},model:{value:(scope.row.leftField),callback:function ($$v) {_vm.$set(scope.row, \"leftField\", $$v)},expression:\"scope.row.leftField\"}},_vm._l((_vm.leftFieldList),function(item){return _c('el-option',{key:item.id,attrs:{\"label\":item.name,\"value\":item.name}})}),1)]}}])}),_c('el-table-column',{attrs:{\"prop\":\"operator\",\"label\":\"操作符\",\"min-width\":\"28%\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [(!scope.row.editable)?_c('div',{staticStyle:{\"width\":\"100%\",\"min-height\":\"28px\",\"text-align\":\"center\"},on:{\"dblclick\":function (){ return scope.row.editable=true; }}},[_vm._v(_vm._s(scope.row.operator))]):_c('el-select',{staticStyle:{\"border\":\"0px\"},attrs:{\"size\":\"mini\",\"filterable\":\"\"},model:{value:(scope.row.operator),callback:function ($$v) {_vm.$set(scope.row, \"operator\", $$v)},expression:\"scope.row.operator\"}},_vm._l((_vm.operatorList),function(val){return _c('el-option',{key:val,attrs:{\"label\":val,\"value\":val}})}),1)]}}])}),_c('el-table-column',{attrs:{\"prop\":\"rightField\",\"label\":_vm.dataSource.sheetLabel,\"min-width\":\"36%\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [(!scope.row.editable)?_c('div',{staticStyle:{\"width\":\"100%\",\"min-height\":\"28px\",\"padding-left\":\"5px\"},on:{\"dblclick\":function (){ return scope.row.editable=true; }}},[_vm._v(_vm._s(scope.row.rightField))]):_c('el-select',{staticStyle:{\"border\":\"0px\"},attrs:{\"size\":\"mini\",\"filterable\":\"\"},on:{\"change\":_vm.onSelectChanged},model:{value:(scope.row.rightField),callback:function ($$v) {_vm.$set(scope.row, \"rightField\", $$v)},expression:\"scope.row.rightField\"}},_vm._l((_vm.rightFieldList),function(item){return _c('el-option',{key:item.id,attrs:{\"label\":item.name,\"value\":item.name}})}),1)]}}])})],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <section>\r\n    <div style=\"height:18px;margin:5px 0;font-size:16px;\">\r\n      关联\r\n      <span style=\"font-size:9px\">(双击行编辑关联条件)</span>\r\n      <div\r\n        class=\"el-icon-close\"\r\n        style=\"position:relative;float:right;right:-7px;top:-7px\"\r\n        @click=\"()=>this.$emit('close')\"\r\n      ></div>\r\n    </div>\r\n    <div>\r\n      <div\r\n        v-for=\"item in unionTypeList\"\r\n        :key=\"item.type\"\r\n        :class=\"{'union-item':true,'union-selected':selectUnionType===item.type}\"\r\n        @click=\"selectUnionType=item.type\"\r\n      >\r\n        <UnionIcon class=\"union-type\" :type=\"item.type\"></UnionIcon>\r\n        <div>{{item.label}}</div>\r\n      </div>\r\n    </div>\r\n    <el-table :data=\"tableData\" style=\"width:100%\" size=\"mini\" border stripe>\r\n      <el-table-column prop=\"leftField\" :label=\"dataSource.preSheetLabel\" min-width=\"36%\">\r\n        <template slot-scope=\"scope\">\r\n          <div\r\n            v-if=\"!scope.row.editable\"\r\n            style=\"width:100%;min-height:28px;padding-left:5px\"\r\n            @dblclick=\"()=>scope.row.editable=true\"\r\n          >{{scope.row.leftField}}</div>\r\n          <el-select\r\n            v-else\r\n            v-model=\"scope.row.leftField\"\r\n            size=\"mini\"\r\n            @change=\"onSelectChanged\"\r\n            filterable\r\n            style=\"border:0px\"\r\n          >\r\n            <el-option\r\n              v-for=\"item in leftFieldList\"\r\n              :key=\"item.id\"\r\n              :label=\"item.name\"\r\n              :value=\"item.name\"\r\n            ></el-option>\r\n          </el-select>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column prop=\"operator\" label=\"操作符\" min-width=\"28%\">\r\n        <template slot-scope=\"scope\">\r\n          <div\r\n            v-if=\"!scope.row.editable\"\r\n            style=\"width:100%;min-height:28px;text-align:center\"\r\n            @dblclick=\"()=>scope.row.editable=true\"\r\n          >{{scope.row.operator}}</div>\r\n          <el-select v-else v-model=\"scope.row.operator\" size=\"mini\" filterable style=\"border:0px\">\r\n            <el-option v-for=\"val in operatorList\" :key=\"val\" :label=\"val\" :value=\"val\"></el-option>\r\n          </el-select>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column prop=\"rightField\" :label=\"dataSource.sheetLabel\" min-width=\"36%\">\r\n        <template slot-scope=\"scope\">\r\n          <div\r\n            v-if=\"!scope.row.editable\"\r\n            style=\"width:100%;min-height:28px;padding-left:5px\"\r\n            @dblclick=\"()=>scope.row.editable=true\"\r\n          >{{scope.row.rightField}}</div>\r\n          <el-select\r\n            v-else\r\n            v-model=\"scope.row.rightField\"\r\n            size=\"mini\"\r\n            @change=\"onSelectChanged\"\r\n            filterable\r\n            style=\"border:0px\"\r\n          >\r\n            <el-option\r\n              v-for=\"item in rightFieldList\"\r\n              :key=\"item.id\"\r\n              :label=\"item.name\"\r\n              :value=\"item.name\"\r\n            ></el-option>\r\n          </el-select>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n  </section>\r\n</template>\r\n\r\n<script>\r\nimport UnionIcon from './UnionIcon.vue'\r\nimport excelProcessor from '@/framework/lib/excel-processor'\r\nexport default {\r\n  components: {\r\n    UnionIcon,\r\n  },\r\n  props: {\r\n    type: {\r\n      type: String,\r\n      default: 'inner-join',\r\n    },\r\n    conditions: {\r\n      type: Array,\r\n      default: () => [],\r\n    },\r\n    dataSource: {\r\n      type: Object,\r\n      default: () => {\r\n        // preDsId: null,\r\n        // preDsName: null,\r\n        // preSheetName:null,\r\n        // preSheetLabel:null,\r\n        // dsId:null,\r\n        // dsName: null,\r\n        //  sheetName: null,\r\n        //   sheetLabel: null,\r\n      },\r\n    },\r\n  },\r\n  computed: {\r\n    leftFieldValue: {\r\n      get() {\r\n        return null\r\n      },\r\n      set(val) {},\r\n    },\r\n  },\r\n  data() {\r\n    this.unionTypeList = [\r\n      {\r\n        type: 'inner-join',\r\n        label: '内部',\r\n      },\r\n      {\r\n        type: 'left-join',\r\n        label: '左侧',\r\n      },\r\n      {\r\n        type: 'right-join',\r\n        label: '右侧',\r\n      },\r\n      {\r\n        type: 'all-join',\r\n        label: '完全外部',\r\n      },\r\n    ]\r\n    this.operatorList = ['=', '<>', '<', '<=', '>', '>=']\r\n    return {\r\n      tableData: [],\r\n      unionType: 'inner-join',\r\n      selectUnionType: null,\r\n      leftFieldList: [\r\n        {\r\n          id: 1,\r\n          name: 'aaaa',\r\n        },\r\n      ],\r\n      rightFieldList: [\r\n        {\r\n          id: 2,\r\n          name: 'bbbbb',\r\n        },\r\n      ],\r\n    }\r\n  },\r\n  created() {\r\n    this.tableData = this.conditions.map(x => {\r\n      return { ...x, editable: false }\r\n    })\r\n    this.tableData.push(this.createConditionRow())\r\n    this.leftFieldList = excelProcessor\r\n      .getAllFields(this.dataSource.preDsId, this.dataSource.preSheetName)\r\n      ?.map(x => {\r\n        return { id: x, name: x } || []\r\n      })\r\n    this.rightFieldList =\r\n      excelProcessor\r\n        .getAllFields(this.dataSource.dsId, this.dataSource.sheetName)\r\n        ?.map(x => {\r\n          return { id: x, name: x }\r\n        }) || []\r\n  },\r\n  methods: {\r\n    createConditionRow() {\r\n      return {\r\n        leftField: null,\r\n        operator: null,\r\n        rightField: null,\r\n        editable: false,\r\n      }\r\n    },\r\n    onSelectChanged(val) {\r\n      // row.editable = false\r\n    },\r\n  },\r\n  watch: {\r\n    tableData: {\r\n      deep: true,\r\n      handler(newVal, oldVal) {\r\n        if (newVal?.length <= 0) return\r\n        const lastRow = newVal[newVal.length - 1]\r\n        let conditions = null\r\n        if (lastRow.leftField && lastRow.operator && lastRow.rightField) {\r\n          lastRow.editable = false\r\n          newVal.push(this.createConditionRow())\r\n          conditions = newVal\r\n        } else {\r\n          conditions = newVal.slice(0, newVal.length - 1)\r\n        }\r\n        this.$emit('update:conditions', conditions)\r\n      },\r\n    },\r\n    selectUnionType(newVal, oldVal) {\r\n      this.$emit('update:type', newVal)\r\n    },\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang='stylus' scoped>\r\n.ds-union\r\n  width: 40%\r\n  position: relative\r\n  display: inline-block\r\n  border: 1px solid gray\r\n.ds-operator\r\n  width: 20%\r\n  position: relative\r\n  display: inline-block\r\n  border: 1px solid gray\r\n.union-item\r\n  display: inline-block\r\n  position: relative\r\n  // height: auto\r\n  padding: 5px\r\n  text-align: center\r\n  vertical-align: middle\r\n  border: 1px solid gray\r\n  width: 25%\r\n  // box-sizing: border-box\r\n  &:hover\r\n    background: #fdfdfd\r\n    border: 1px solid #a1d6ff\r\n.union-selected\r\n  border: 1.2px solid #52b2fe !important\r\n  color: #28a7f2\r\n  font-size: 15px\r\n</style>\r\n","import mod from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UnionPopover.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UnionPopover.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./UnionPopover.vue?vue&type=template&id=dc3f0aea&scoped=true&\"\nimport script from \"./UnionPopover.vue?vue&type=script&lang=js&\"\nexport * from \"./UnionPopover.vue?vue&type=script&lang=js&\"\nimport style0 from \"./UnionPopover.vue?vue&type=style&index=0&id=dc3f0aea&lang=stylus&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"dc3f0aea\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {\nvar this$1 = this;\nvar _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticStyle:{\"display\":\"inline-block\"}},[_c('el-tag',{staticClass:\"data-source-block\",attrs:{\"closable\":\"\"},on:{\"close\":function (){ return this$1.$emit('close'); }}},[_c('div',{staticClass:\"ds-alias\"},[_vm._v(_vm._s(_vm.title))])])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div style=\"display:inline-block\">\r\n    <el-tag class=\"data-source-block\" closable @close=\"()=>this.$emit('close')\">\r\n      <div class=\"ds-alias\">{{title}}</div>\r\n    </el-tag>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  props: {\r\n    title: {\r\n      type: String,\r\n      default: '',\r\n    },\r\n  },\r\n  data() {\r\n    return {}\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang='stylus' scoped>\r\n.ds-alias\r\n  width: calc(100% - 12px)\r\n  display: inline-block\r\n.data-source-block\r\n  width: 100%\r\n  height: 100%\r\n</style>\r\n","import mod from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DataSourceBlock.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DataSourceBlock.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./DataSourceBlock.vue?vue&type=template&id=20cfbc64&scoped=true&\"\nimport script from \"./DataSourceBlock.vue?vue&type=script&lang=js&\"\nexport * from \"./DataSourceBlock.vue?vue&type=script&lang=js&\"\nimport style0 from \"./DataSourceBlock.vue?vue&type=style&index=0&id=20cfbc64&lang=stylus&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"20cfbc64\",\n  null\n  \n)\n\nexport default component.exports","<template>\r\n  <!-- <div style=\"width:auto;height:100%;position:relative;overflow-x:hidden\">\r\n    <UnionItem ref=\"unionItem\" :tree-data=\"dataSourceTree\"></UnionItem>\r\n  </div>-->\r\n  <div\r\n    class=\"union-box\"\r\n    @dragenter.stop.prevent=\"onDragEnter\"\r\n    @dragover.stop.prevent=\"onDragOver\"\r\n    @dragleave.stop.prevent=\"onDragLeave\"\r\n    @drop.stop.prevent=\"onDrop\"\r\n  >\r\n    <svg-icon icon-class=\"filter-line\" class-name=\"ds-filter\" @click=\"dialogVisible=true\"></svg-icon>\r\n    <div\r\n      v-for=\"node in dataSourceNodes\"\r\n      :key=\"'union-box-'+node.id\"\r\n      :style=\"`left:${node.position.x}px;top:${node.position.y}px`\"\r\n      class=\"node-box\"\r\n    >\r\n      <el-popover\r\n        v-show=\"!node.root\"\r\n        @hook:updated=\"onPopoverUpdated(node)\"\r\n        v-model=\"node.settersvisible\"\r\n        placement=\"bottom\"\r\n        width=\"360\"\r\n        trigger=\"click\"\r\n      >\r\n        <UnionPopover\r\n          :type.sync=\"node.unionType\"\r\n          :data-source=\"node.dataSource\"\r\n          :conditions.sync=\"node.conditions\"\r\n          @close=\"onPopoverClose(node)\"\r\n        ></UnionPopover>\r\n        <UnionIcon\r\n          slot=\"reference\"\r\n          :id=\"'union'+node.id\"\r\n          :key=\"'union'+node.id\"\r\n          :type=\"node.unionType\"\r\n          :have-union=\"node.conditions.length>0\"\r\n          class=\"union-icon\"\r\n        ></UnionIcon>\r\n      </el-popover>\r\n      <DataSourceBlock\r\n        :id=\"'block'+node.id\"\r\n        :key=\"'block'+node.id\"\r\n        :title=\"node.alias\"\r\n        :style=\"`width:${blockWidth}px`\"\r\n        @close=\"onNodeClose(node)\"\r\n      ></DataSourceBlock>\r\n    </div>\r\n    <div v-show=\"!dataSourceNodes.length\" class=\"empty-info\">拖入数据表进行组合关联</div>\r\n\r\n    <el-dialog title=\"自定义过滤条件\" :visible.sync=\"dialogVisible\">\r\n      <h3>有待实现,敬请期待...</h3>\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button size=\"mini\" @click=\"dialogVisible=false\">取消</el-button>\r\n        <el-button type=\"primary\" size=\"mini\" @click=\"onFilterCommit()\">确定</el-button>\r\n      </div>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport UnionIcon from './UnionIcon.vue'\r\nimport UnionPopover from './UnionPopover.vue'\r\nimport DataSourceBlock from './DataSourceBlock.vue'\r\nimport { newUuid } from '@/lib/utils'\r\nexport default {\r\n  components: {\r\n    DataSourceBlock,\r\n    UnionIcon,\r\n    UnionPopover,\r\n  },\r\n  data() {\r\n    this.blockHeight = 26\r\n    this.blockWidth = 160\r\n    this.unionIconWidth = 32 + 30 * 2 //union的iconwidth:32,margin:0 30\r\n    this.lineOptions = {\r\n      color: 'rgba(30, 130, 250, 0.5)',\r\n      size: 1,\r\n      // path: 'grid',\r\n      startPlug: 'behind', //disc\r\n      startPlugSize: 1,\r\n      endPlug: 'behind', //'behind'\r\n      endPlugSize: 1,\r\n    }\r\n    this.lineList = []\r\n    return {\r\n      dialogVisible: false,\r\n      dataSourceTree: [],\r\n    }\r\n  },\r\n  computed: {\r\n    dataSourceNodes() {\r\n      return this.nodeTree2List(this.dataSourceTree)\r\n    },\r\n  },\r\n  mounted() {\r\n    this.canvas = document.querySelector('#ds-board-canvas')\r\n    // this.initUnionTree(this.dataSourceTree)\r\n    this.initUnionTree([])\r\n  },\r\n  methods: {\r\n    onPopoverUpdated(node) {\r\n      if (node.settersvisible === null) {\r\n        node.settersvisible = !node.root\r\n      }\r\n    },\r\n    onPopoverClose(node) {\r\n      node.settersvisible = false\r\n    },\r\n    initUnionTree(dataSourceTree) {\r\n      this.drawAllNodeLines(dataSourceTree)\r\n    },\r\n    nodeTree2List(tree) {\r\n      let list = []\r\n      tree?.forEach(leaf => {\r\n        list.push(leaf)\r\n        if (leaf.relations?.length > 0) {\r\n          list = list.concat(this.nodeTree2List(leaf.relations))\r\n        }\r\n      })\r\n      return list\r\n    },\r\n    createDsNode(sheet, unionTargetNode) {\r\n      let posX = 0\r\n      let posY = 0\r\n      if (unionTargetNode) {\r\n        posX =\r\n          unionTargetNode.position?.x +\r\n          this.blockWidth +\r\n          (unionTargetNode.root ? 0 : this.unionIconWidth)\r\n\r\n        const childCount = unionTargetNode.relations?.length\r\n        if (childCount === 0) {\r\n          posY = unionTargetNode.position?.y\r\n        } else {\r\n          posY = unionTargetNode.relations[childCount - 1].y + this.blockHeight\r\n        }\r\n      }\r\n      return {\r\n        id: newUuid(),\r\n        parentId: unionTargetNode?.id,\r\n        name: sheet.name,\r\n        alias: sheet.label,\r\n        unionType: '',\r\n        settersvisible: null,\r\n        position: {\r\n          x: posX || 10, //若为第一个节点,则默认初始化10\r\n          y: posY || 10,\r\n        },\r\n        dataSource: {\r\n          preDsId: unionTargetNode?.dataSource.dsId,\r\n          preDsName: unionTargetNode?.dataSource.dsName,\r\n          preSheetName: unionTargetNode?.dataSource.sheetName,\r\n          preSheetLabel: unionTargetNode?.dataSource.sheetLabel,\r\n          dsId: sheet.dsId,\r\n          dsName: sheet.dsName,\r\n          sheetName: sheet.name,\r\n          sheetLabel: sheet.label,\r\n        },\r\n        conditions: [\r\n          // {\r\n          //   leftField: 'a',\r\n          //   operator: '=',\r\n          //   rightField: 'b',\r\n          // },\r\n        ],\r\n        filter: [], //其他使用筛选器\r\n        relations: [],\r\n      }\r\n    },\r\n    getUnionTargetNode(x, y) {\r\n      let unionNode = null\r\n      this.dataSourceNodes?.forEach(node => {\r\n        //若y轴坐标小于鼠标停放y坐标\r\n        if (node.position.y < y) {\r\n          unionNode = unionNode || node //若关联节点为空,则先赋值第一个满足条件的\r\n          //同时,与已满足条件节点比较,当前节点的y轴更接近鼠标位置,则使用新的节点\r\n          if (node.position.y > unionNode.position.y) {\r\n            unionNode = node\r\n          }\r\n        }\r\n        //当满足y轴的节点,开始匹配满足x轴的节点\r\n        if (unionNode && node.position.x < x) {\r\n          //与已满足条件节点比较,当前节点的x轴更接近鼠标位置,则使用新的节点\r\n          if (node.position.x > unionNode.position.x) {\r\n            unionNode = node\r\n          }\r\n        }\r\n      })\r\n      return unionNode\r\n    },\r\n    onNodeClose(node) {\r\n      const delNode = (nodeList, childNode) => {\r\n        if (!nodeList?.length) return false\r\n        for (let i = 0; i < nodeList.length; i++) {\r\n          const curNode = nodeList[i]\r\n          if (curNode.id === childNode.id) {\r\n            nodeList = nodeList.splice(i, 1)\r\n            return true\r\n          }\r\n          return delNode(curNode.relations, childNode)\r\n        }\r\n      }\r\n      delNode(this.dataSourceTree, node)\r\n\r\n      const delLine = node => {\r\n        //删除线\r\n        const matchLines = this.lineList?.filter(\r\n          x => x.beginEleId == node.parentId && x.endEleId === node.id\r\n        )\r\n        matchLines?.forEach(x => {\r\n          x.line.remove()\r\n        })\r\n        node.relations?.forEach(x => delLine(x))\r\n      }\r\n      delLine(node)\r\n    },\r\n    onDrop(event) {\r\n      console.log('onDrop ', event)\r\n      const sheetStr = event.dataTransfer.getData('dataSourceSheet')\r\n      if (!sheetStr) return\r\n      const posX = event.offsetX || event.layerX\r\n      const posY = event.offsetY || event.layerY\r\n      const sheet = JSON.parse(sheetStr)\r\n\r\n      const unionTargetNode = this.getUnionTargetNode(posX, posY)\r\n      const newNode = this.createDsNode(sheet, unionTargetNode)\r\n      if (unionTargetNode) {\r\n        unionTargetNode.relations.push(newNode)\r\n      }\r\n      const isRoot = this.dataSourceNodes.length <= 0\r\n      if (isRoot) {\r\n        newNode.root = true\r\n        this.dataSourceTree.push(newNode)\r\n      } else {\r\n        this.$nextTick(() => {\r\n          this.drawNodeLine(unionTargetNode.id, newNode.id)\r\n          // this.$refs.unionPopover.value = true\r\n        })\r\n      }\r\n    },\r\n    onDragEnter(event) {},\r\n    onDragOver(event) {},\r\n    onDragLeave(event) {},\r\n    close() {\r\n      this.clearLines()\r\n    },\r\n    drawAllNodeLines(nodeTree) {\r\n      this.clearLines()\r\n      nodeTree?.forEach(node => {\r\n        if (node.relations?.length > 0) {\r\n          node.relations?.forEach(next => {\r\n            this.drawLine(node.id, next.id)\r\n          })\r\n        }\r\n      })\r\n    },\r\n    drawNodeLine(nodeId, nextNodeId) {\r\n      const preEle = document.querySelector('#block' + nodeId)\r\n      const unionEle = document.querySelector('#union' + nextNodeId)\r\n      const nextEle = document.querySelector('#block' + nextNodeId)\r\n      if (preEle && unionEle) {\r\n        // eslint-disable-next-line no-undef\r\n        const line = new LeaderLine(preEle, unionEle, this.lineOptions)\r\n        this.lineList.push({\r\n          beginEleId: nodeId,\r\n          endEleId: nextNodeId,\r\n          line: line,\r\n        })\r\n      }\r\n      if (unionEle && nextEle) {\r\n        // eslint-disable-next-line no-undef\r\n        const line = new LeaderLine(unionEle, nextEle, this.lineOptions)\r\n        this.lineList.push({\r\n          beginEleId: nodeId,\r\n          endEleId: nextNodeId,\r\n          line: line,\r\n        })\r\n      }\r\n    },\r\n    clearLines() {\r\n      try {\r\n        this.lineList?.forEach(x => {\r\n          x.line.remove()\r\n        })\r\n        this.lineList = []\r\n      } catch (err) {\r\n        this.$message.error(err?.message)\r\n      }\r\n    },\r\n    //TODO:后续需要编写独立API进行绘制\r\n    drawCanvasLine(startPoi, endPoi, options) {\r\n      const context = this.canvas.getContext('2d')\r\n      const _options = {\r\n        strokeStyle: '#e6c7ff',\r\n        lineWidth: 2,\r\n      }\r\n      Object.assign(context, _options, options)\r\n      context.beginPath() // 开始点\r\n      context.moveTo(startPoi[0], startPoi[1])\r\n      context.lineTo(endPoi[0], endPoi[1])\r\n      context.stroke() // 进行绘制外边框\r\n    },\r\n    onFilterCommit() {\r\n      this.dialogVisible = false\r\n    },\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang='stylus' scoped>\r\n.ds-filter\r\n  position: absolute\r\n  right: 5px\r\n  top: 5px\r\n.union-box\r\n  display: inline-block\r\n  position: relative\r\n  width: 100%\r\n  height: 100%\r\n  border: 1.5px solid #cacaca\r\n.node-box\r\n  position: absolute\r\n  display: inline-block\r\n.union-box::after\r\n  content: ''\r\n  display: inline-block\r\n  vertical-align: middle\r\n  text-align: center\r\n  height: 100%\r\n.union-icon\r\n  margin: 0 30px\r\n  // width: 90px\r\n  vertical-align: middle\r\n  text-align: center\r\n  height: auto\r\n</style>\r\n","import mod from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UnionBoard.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UnionBoard.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./UnionBoard.vue?vue&type=template&id=f8855f36&scoped=true&\"\nimport script from \"./UnionBoard.vue?vue&type=script&lang=js&\"\nexport * from \"./UnionBoard.vue?vue&type=script&lang=js&\"\nimport style0 from \"./UnionBoard.vue?vue&type=style&index=0&id=f8855f36&lang=stylus&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"f8855f36\",\n  null\n  \n)\n\nexport default component.exports","<template>\r\n  <el-container class=\"union-box\">\r\n    <el-header style=\"padding:0px;height:auto;margin-bottom:2px\">\r\n      <h2 style=\"display:inline-block\">数据创建连接</h2>\r\n      <el-button\r\n        size=\"small\"\r\n        type=\"primary\"\r\n        style=\"display:inline-block;margin-left:20px\"\r\n        @click=\"onClose\"\r\n      >关闭</el-button>\r\n    </el-header>\r\n    <el-main style=\"height:100%;padding:0 20px\">\r\n      <UnionBoard ref=\"unionBoard\"></UnionBoard>\r\n    </el-main>\r\n    <el-footer class=\"footer\">\r\n      <div style=\"height:30px;margin-bottom:6px\">\r\n        排序字段\r\n        <el-select v-model=\"sortType\" size=\"mini\" style=\"width:120px\">\r\n          <el-option label=\"数据源排序\" value=\"database\"></el-option>\r\n          <el-option label=\"A-Z升序\" value=\"asc\"></el-option>\r\n          <el-option label=\"A-Z降序\" value=\"desc\"></el-option>\r\n          <el-option label=\"按表A-Z升序\" value=\"t-asc\"></el-option>\r\n          <el-option label=\"按表A-Z降序\" value=\"t-desc\"></el-option>\r\n        </el-select>\r\n        <div style=\"display:inline-block;float:right\">\r\n          <el-checkbox size=\"mini\" v-model=\"aliasVisible\">显示别名</el-checkbox>\r\n          <el-input size=\"mini\" v-model=\"rowCount\" style=\"margin:0 5px 0 20px;width:80px\"></el-input>行\r\n        </div>\r\n      </div>\r\n      <el-table style=\"width:100%;\" stripe border></el-table>\r\n    </el-footer>\r\n  </el-container>\r\n</template>\r\n\r\n<script>\r\nimport { mapActions } from 'vuex'\r\nimport UnionBoard from './UnionBoard.vue'\r\nexport default {\r\n  components: {\r\n    UnionBoard,\r\n  },\r\n  data() {\r\n    return {\r\n      aliasVisible: true,\r\n      rowCount: 16,\r\n      sortType: 'database',\r\n    }\r\n  },\r\n  created() {},\r\n  methods: {\r\n    ...mapActions('settings', ['changeSettings']),\r\n    onClose() {\r\n      this.$refs.unionBoard.close()\r\n      this.changeSettings({ dataSourceUnion: false })\r\n    },\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang='stylus' scoped>\r\n.union-box\r\n  height: 100%\r\n  width: 100%\r\n  padding: 10px\r\n.footer\r\n  padding-top: 20px\r\n  min-height: 60%\r\n  max-height: 60%\r\n  height: auto\r\n  width: 100%\r\n</style>\r\n","import mod from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=40050d16&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=40050d16&lang=stylus&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"40050d16\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../../../node_modules/stylus-loader/index.js??ref--11-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=40050d16&lang=stylus&scoped=true&\"","export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../../../node_modules/stylus-loader/index.js??ref--11-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UnionIcon.vue?vue&type=style&index=0&id=6e470edd&lang=stylus&scoped=true&\"","export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../../../node_modules/stylus-loader/index.js??ref--11-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UnionPopover.vue?vue&type=style&index=0&id=dc3f0aea&lang=stylus&scoped=true&\""],"sourceRoot":""}